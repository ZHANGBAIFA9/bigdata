# ZOOKEEPER简介

### 1、zookeeper原理

​	

### 2、选举机制

​	2.1、（案例3台zookeeper服务器）初搭建完成，**逐一启动**，leader选举为node3，**同时启动**，leader选举为node4，即谁年龄大谁为leader，原因由于第一次搭建集群启动时没有数据ID和逻辑时钟，顺序启动先给自己投票，若大于半数则为leader，并且**权重(myid)**大获取权重小的投票。

​	2.2、运行过程中leader挂掉，触发选举机制，由于不是全新集群，即存在**服务器ID**、**数据ID**和**逻辑时钟**，首先判断**逻辑时钟**，**逻辑时钟**小则中途存在**宕机问题**则忽略其选举结果，其次**统一逻辑时钟**后，对比**数据ID值**，**数据ID值**反应数据的**新旧程度**，因此**数据ID值**大胜出，最后如果**逻辑时钟和数据ID值**都**相同**，则**服务器编号**大的胜出，**优中选优**，保证**leader**是zookeeper集群中**数据最完整最可靠**的一台服务器。

### 3、广播模式

​	

### 4、提供集群服务

​	**原子性：**准确反馈成功还是失败

​	**一致性：**每个server都有统一的数据视图

​	**可用性：**节点故障不影响使用，少于一半的宕机，没有问题

​	**网络分区/脑裂：**过半通过

### 5、ZooKeeper会话

​	5.1、客户端通过TCP协议与独立服务器或者一个集群中的某个服务器建立会话连接。

​	5.2、会话提供顺序保障，即同一个会话中的请求以FIFO的顺序执行。如果客户端有多个并发会话，FIFO顺序在多个会话之间未必能够保持。

​	5.3、如果连接的Server出现问题，在没有超过Timeout时间时，可以连接其他节点。ZooKeeper客户端透明地转移一个会话到不同的服务器。

​	5.4、同一session期内的特性不变

​	5.5、当一个会话因某种原因终止，在这个会话期间创建的临时节点将会消失。

​	Session是由谁来创建的？

​	Leader：产生一个唯一的session，放到消息队列，让所有server知道

​	过半机制：保证session创建成功或者失败

​		